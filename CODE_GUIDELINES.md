Регламент по Файловой Структуре Проекта "ПТО-Пророк"
1. Общие Принципы
Изоляция Проектов: Каждый отдельный проект (обработка одной сметы) должен находиться в своей собственной, изолированной директории. Это предотвращает путаницу и случайное изменение данных.
Атомарность Этапов: Результат работы каждого модуля конвейера сохраняется в отдельную, нумерованную поддиректорию. Это обеспечивает возможность возобновления процесса с любого шага и упрощает отладку.
Единый Источник Правды: Начиная с этапа подготовки, все данные, относящиеся к проекту (работы, контекст, директивы, результаты), хранятся в одном мастер-файле project_data.json.
Логирование Взаимодействия с AI: Каждый вызов к LLM должен быть задокументирован. Для каждого AI-агента сохраняются два файла: llm_input.json (что мы отправили) и llm_response.json (что мы получили в сыром виде).
Именование: Все файлы и папки именуются в snake_case (нижний регистр со словами, разделенными подчеркиванием) для единообразия и кроссплатформенности.
2. Иерархия Директорий Проекта
Для каждого нового проекта, инициированного пользователем, создается следующая структура папок:

/projects/
└── {user_id}/
    └── {project_id}/
        │
        ├── 0_input/
        ├── 1_extracted/
        ├── 2_classified/
        ├── 3_prepared/
        ├── 4_conceptualized/
        ├── 5_scheduled/
        ├── 6_accounted/
        ├── 7_staffed/
        └── 8_output/
{user_id}: Уникальный идентификатор пользователя (например, telegram_user_id_12345).
{project_id}: Уникальный идентификатор проекта (рекомендуется использовать uuid или комбинацию timestamp + source_filename_hash).
3. Содержимое и Назначение Каждой Директории
0_input/

Назначение: Хранение исходных, неизменяемых файлов, полученных от пользователя.
Содержимое:
estimate.xlsx: Оригинальный файл сметы.
directives.json: Файл с управляющими параметрами и директивами, сформированный ботом по результатам опроса пользователя.
1_extracted/

Назначение: Результат работы модуля extractor.py.
Содержимое:
raw_estimates.json: JSON-файл, содержащий сырой, нефильтрованный список всех позиций, извлеченных из estimate.xlsx.
2_classified/

Назначение: Результат работы модуля classifier.py.
Содержимое:
classified_estimates.json: Копия raw_estimates.json, но с добавленным полем classification ("Работа", "Материал") для каждой позиции.
llm_request.json (опционально, если были неясные случаи): Запрос к LLM для классификации.
llm_response.json (опционально): Ответ от LLM.
3_prepared/

Назначение: Результат работы модуля preparer.py. Создание единого рабочего файла проекта.
Содержимое:
project_data.json: Главный мастер-файл проекта. Содержит отфильтрованные работы, timeline_blocks, а также все данные из directives.json, структурированные внутри ключа metadata. Это единственный файл, который будет передаваться дальше по конвейеру.
4_conceptualized/ до 7_staffed/ (Шаги работы AI-агентов)

Назначение: Хранение промежуточных результатов и логов работы каждого AI-агента. Структура для всех этих папок идентична.
Содержимое (на примере 4_conceptualized/):
llm_input.json: Полный, отформатированный запрос, который был отправлен в LLM на данном шаге.
llm_response.json: Полный, сырой JSON-ответ, полученный от LLM.
project_data.json: Обновленная версия мастер-файла, обогащенная результатами работы данного агента.
8_output/

Назначение: Хранение финального, готового для пользователя результата.
Содержимое:
schedule.xlsx: Итоговый график производства работ в формате Excel.
final_project_data.json (опционально): Копия project_data.json из папки 7_staffed/ для удобства и полноты архива.
4. Правила для Cloud Code и Разработчика
Никогда не изменять файлы в предыдущих папках. Если нужно перезапустить процесс с 5-го шага, скрипт должен читать project_data.json из папки 4_conceptualized/ и сохранять результат в 5_scheduled/.
Каждый модуль должен быть идемпотентным. Повторный запуск модуля с теми же входными данными должен давать тот же результат.
Путь к текущей рабочей директории проекта (/projects/{user_id}/{project_id}/) должен быть базовым параметром, который передается в каждую основную функцию конвейера.
Все пути к файлам внутри кода должны строиться относительно этой базовой директории, используя os.path.join или pathlib, чтобы обеспечить кроссплатформенность.
Логирование обязательно. Помимо сохранения llm_input/output, каждый модуль должен писать в общий лог-файл информацию о начале и конце своей работы, а также о любых ошибках.
Этот свод правил обеспечивает строгий порядок, прозрачность и отказоустойчивость всей системы. Его можно сохранить как CODE_GUIDELINES.md в корне репозитория.